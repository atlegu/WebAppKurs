import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://tqpryezzddufpovfbpld.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHJ5ZXp6ZGR1ZnBvdmZicGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0NjA5MDksImV4cCI6MjA2NzAzNjkwOX0.TYmpggmCUr_7aNN_KKC5igvyT_QOWjFpa4_wlX_hjpE';

const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Module 3.6 content - proper structure for sub-modules
const module36Content = {
  sections: [
    {
      title: "Renteperioder og effektiv rente",
      type: "content",
      content: `**La oss utforske forskjellen mellom nominell og effektiv rente!**

Start med √• eksperimentere med kalkulatoren nedenfor. Legg spesielt merke til hvordan hyppigere renteberegning gir h√∏yere effektiv rente.

!component:effective-rate

**Hvorfor er dette viktig?**

N√•r vi sammenligner renter og investeringer, er det ikke alltid √•penbart hvilken som er best. En rente p√• 10% per √•r h√∏res ut som det samme uansett, men det kommer helt an p√• hvordan renten beregnes!

La oss se p√• et konkret eksempel:
‚Ä¢ Alternativ A: 10% rente per √•r, beregnet √•rlig
‚Ä¢ Alternativ B: 10% rente per √•r, beregnet halv√•rlig

Hvis du investerer 1 kr:
‚Ä¢ Alternativ A: 1 kr √ó 1,10 = 1,10 kr etter ett √•r
‚Ä¢ Alternativ B: 1 kr √ó 1,05 √ó 1,05 = 1,1025 kr etter ett √•r

Forskjellen p√• 0,0025 kr virker liten, men p√• st√∏rre bel√∏p og over tid blir dette betydelig!

**Nominell vs. effektiv rente**

‚Ä¢ **Nominell rente** (ogs√• kalt oppgitt eller kvotert rente): Den renten som oppgis, f.eks. "10% per √•r"
‚Ä¢ **Effektiv √•rlig rente (EAR)**: Den faktiske √•rlige avkastningen n√•r vi tar hensyn til rentesammensetning

**Perioderente**

N√•r renten beregnes flere ganger per √•r, m√• vi f√∏rst finne perioderenten:

Perioderente = Nominell √•rlig rente / Antall perioder per √•r

For eksempel:
‚Ä¢ 12% nominell rente med m√•nedlig beregning: 12% / 12 = 1% per m√•ned
‚Ä¢ 8% nominell rente med kvartalsvis beregning: 8% / 4 = 2% per kvartal

**Formelen for effektiv √•rlig rente**

For diskret rentesammensetning (√•rlig, m√•nedlig, daglig osv.):

**EAR = (1 + r/n)^n - 1**

hvor:
‚Ä¢ r = nominell √•rlig rente
‚Ä¢ n = antall renteperioder per √•r

For kontinuerlig rentesammensetning:

**EAR = e^r - 1**

hvor e ‚âà 2,71828 (Eulers tall)

**Eksempler fra virkeligheten**

**1. Kredittkort**
Mange kredittkort oppgir en m√•nedlig rente p√• 2%. Hva er den effektive √•rlige renten?
‚Ä¢ Nominell √•rlig: 2% √ó 12 = 24%
‚Ä¢ Effektiv √•rlig: (1,02)^12 - 1 = 26,82%

**2. Sparekonto med daglig renteberegning**
En sparekonto tilbyr 3% √•rlig rente med daglig kapitalisering:
‚Ä¢ EAR = (1 + 0,03/365)^365 - 1 = 3,045%

**3. Boligl√•n**
Norske boligl√•n beregner ofte rente kvartalsvis, selv om de oppgir √•rlig rente. Et l√•n med 4% nominell rente:
‚Ä¢ EAR = (1 + 0,04/4)^4 - 1 = 4,06%

**APR vs. EAR**

I USA brukes ofte APR (Annual Percentage Rate), som er nominell rente. I Norge m√• l√•ngivere oppgi effektiv rente, som inkluderer b√•de rentesammensetning og gebyrer.

**Konvertering mellom perioder**

Noen ganger trenger vi √• konvertere mellom ulike perioder. For eksempel:

Fra √•rlig til m√•nedlig:
M√•nedlig rente = (1 + √•rlig rente)^(1/12) - 1

Fra m√•nedlig til √•rlig:
√Örlig rente = (1 + m√•nedlig rente)^12 - 1

**Oppgaveeksempel: Avbetalingsordning**

La oss l√∏se oppgaven du nevnte:

"I stedet for √• betale kr 10.000 kontant, kan du sl√• til p√• en avbetalingsordning som inneb√¶rer at du betaler kr 2.500 kontant og resten i form av 12 m√•nedlige bel√∏p, f√∏rste gang om en m√•ned. Du har regnet deg frem til at den √•rlige effektive renten knyttet til avbetalingsordningen er 60,1%. Hvor stort er det m√•nedlige bel√∏pet?"

**L√∏sning:**
1. Restbel√∏p √• finansiere: 10.000 - 2.500 = 7.500 kr
2. √Örlig effektiv rente: 60,1%
3. M√•nedlig rente: (1,601)^(1/12) - 1 = 0,04 = 4%
4. Bruk annuitetsformelen: M√•nedlig betaling = 7.500 / AF(4%, 12)
5. AF(4%, 12) = [1/0,04 - 1/(0,04 √ó 1,04^12)] = 9,385
6. M√•nedlig betaling = 7.500 / 9,385 = 799,15 kr

**Praktiske tips**

‚Ä¢ **For sparere**: Velg kontoer med hyppigst mulig renteberegning
‚Ä¢ **For l√•ntakere**: V√¶r oppmerksom p√• den effektive renten, ikke bare den nominelle
‚Ä¢ **Ved sammenligning**: Konverter alltid til effektiv √•rlig rente
‚Ä¢ **Forsiktig med gebyrer**: Effektiv rente inkluderer ofte gebyrer i tillegg til renten

**üéØ Det viktigste √• huske**

‚Ä¢ Nominell rente ‚â† Effektiv rente n√•r det er rentesammensetning
‚Ä¢ Jo oftere renten beregnes, desto h√∏yere effektiv rente
‚Ä¢ Effektiv √•rlig rente (EAR) = (1 + r/n)^n - 1
‚Ä¢ Alltid sammenlign effektive renter, ikke nominelle
‚Ä¢ Sm√• forskjeller i rente blir store over tid

**Refleksjonssp√∏rsm√•l:** Hvorfor tror du forbruksl√•n og kredittkort ofte oppgir m√•nedlig rente i stedet for √•rlig effektiv rente? Hvordan p√•virker dette forbrukernes oppfatning av kostnadene?`
    }
  ]
};

async function addModule36() {
  try {
    // First find module 3 (Tidsverdien av penger)
    const { data: module3, error: moduleError } = await supabase
      .from('modules')
      .select('id')
      .eq('order_index', 3)
      .single();

    if (moduleError) {
      console.error('Error fetching module 3:', moduleError);
      return;
    }

    console.log('Found module 3 with id:', module3.id);

    // Check if sub-module 3.6 already exists
    const { data: existingSubModule, error: fetchError } = await supabase
      .from('sub_modules')
      .select('*')
      .eq('module_id', module3.id)
      .eq('order_index', 6)
      .single();

    if (fetchError && fetchError.code !== 'PGRST116') {
      console.error('Error fetching sub-module:', fetchError);
      return;
    }

    if (existingSubModule) {
      // Update existing sub-module
      const { error: updateError } = await supabase
        .from('sub_modules')
        .update({ 
          title: 'Renteperioder og effektiv rente',
          content: module36Content,
          updated_at: new Date().toISOString()
        })
        .eq('id', existingSubModule.id);

      if (updateError) {
        console.error('Error updating sub-module 3.6:', updateError);
      } else {
        console.log('Successfully updated sub-module 3.6');
      }
    } else {
      // Create new sub-module
      const { error: insertError } = await supabase
        .from('sub_modules')
        .insert({
          module_id: module3.id,
          title: 'Renteperioder og effektiv rente',
          content: module36Content,
          order_index: 6,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        });

      if (insertError) {
        console.error('Error creating sub-module 3.6:', insertError);
      } else {
        console.log('Successfully created sub-module 3.6');
      }
    }
  } catch (error) {
    console.error('Unexpected error:', error);
  }
}

addModule36();