import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://tqpryezzddufpovfbpld.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHJ5ZXp6ZGR1ZnBvdmZicGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0NjA5MDksImV4cCI6MjA2NzAzNjkwOX0.TYmpggmCUr_7aNN_KKC5igvyT_QOWjFpa4_wlX_hjpE';

const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Module 7.1 content
const module71Content = {
  sections: [
    {
      title: "Hvorfor investeringsanalyse?",
      type: "content",
      content: `**Fra hverdagsvalg til milliardbeslutninger**

La oss starte med en fundamental innsikt: Hver gang du tar en beslutning som involverer penger over tid, gj√∏r du en investering. Enten du er klar over det eller ikke.

!component:investment-introduction

**Hva er egentlig en investering?**

En investering er fundamentalt sett √• gi avkall p√• noe av verdi i dag (vanligvis penger, men ogs√• tid eller andre ressurser) for √• oppn√• noe av st√∏rre verdi i fremtiden. Dette h√∏res enkelt ut, men det er tre kritiske elementer som gj√∏r investeringer komplekse:

1. **Tidsdimensjonen**: Kostnadene kommer vanligvis f√∏rst, gevinstene senere
2. **Usikkerheten**: Fremtidige inntekter er sjelden garantert
3. **Alternativkostnaden**: Pengene kunne v√¶rt brukt p√• noe annet

**Investeringer er overalt**

La oss se p√• noen eksempler du kanskje ikke tenker p√• som investeringer:

**Personlige investeringer:**
‚Ä¢ **Utdanning**: Du betaler studieavgift og gir avkall p√• arbeidsinntekt i studietiden. Gevinsten? H√∏yere l√∏nn og bedre karrieremuligheter senere.
‚Ä¢ **Helse**: Treningsmedlemskap koster penger og tid n√•, men gir bedre helse og lavere helseutgifter senere.
‚Ä¢ **Bolig**: Kj√∏pe vs. leie - en klassisk investeringsbeslutning de fleste m√• ta.

**Bedriftsinvesteringer:**
‚Ä¢ **Produksjonsutstyr**: En fabrikk som kj√∏per nye maskiner for √• √∏ke kapasiteten
‚Ä¢ **Markedsf√∏ring**: Reklamekampanje som koster millioner n√•, forh√•pentligvis √∏ker salget senere
‚Ä¢ **Ansatte**: Oppl√¶ring og utvikling av medarbeidere

**Samfunnsinvesteringer:**
‚Ä¢ **Infrastruktur**: Veier, broer, kollektivtransport
‚Ä¢ **Milj√∏tiltak**: Solcelleparker, vindm√∏ller, karbonfangst
‚Ä¢ **Forskning**: Grunnforskning som kanskje gir resultater om 20 √•r

**Hvorfor kan vi ikke bare bruke magef√∏lelsen?**

Tenk deg at du skal velge mellom:
- Alternativ A: Betale 100.000 kr n√•, f√• 150.000 kr om 5 √•r
- Alternativ B: Betale 80.000 kr n√•, f√• 130.000 kr om 4 √•r

Hvilket alternativ er best? Uten investeringsanalyse er det umulig √• svare objektivt. Vi m√• ta hensyn til:
‚Ä¢ Tidsverdien av penger (penger i dag er mer verdt enn penger i morgen)
‚Ä¢ Risikoen i hvert alternativ
‚Ä¢ Hva pengene alternativt kunne gitt av avkastning

**Beslutninger uten analyse = Gambling**

N√•r bedrifter eller privatpersoner tar investeringsbeslutninger uten grundig analyse, er det i praksis gambling. Du satser p√• at det g√•r bra, men har ingen objektiv grunn til √• tro det.

Typiske feilslutninger uten analyse:
‚Ä¢ "Naboen gjorde det samme og det gikk bra"
‚Ä¢ "Vi har alltid gjort det s√•nn"
‚Ä¢ "Det f√∏les som en god id√©"
‚Ä¢ "Alle andre gj√∏r det"

**Hva er investeringsanalyse?**

Investeringsanalyse er systematiske metoder for √•:
1. **Identifisere** alle relevante kostnader og inntekter
2. **Kvantifisere** disse i kroner og √∏re
3. **Tidsjustere** ved √• ta hensyn til n√•r pengene kommer/g√•r
4. **Sammenligne** alternativer p√• objektiv basis
5. **Vurdere risiko** og usikkerhet
6. **Ta beslutning** basert p√• klare kriterier

**Verkt√∏ykassen v√•r**

I denne modulen skal du l√¶re de viktigste verkt√∏yene:

‚Ä¢ **Kontantstr√∏manalyse**: Kartlegge alle inn- og utbetalinger
‚Ä¢ **N√•verdi (NPV)**: Hovedverkt√∏yet for √• vurdere l√∏nnsomhet
‚Ä¢ **Internrente (IRR)**: Vise avkastning i prosent
‚Ä¢ **Tilbakebetalingstid**: Hvor raskt f√•r vi pengene tilbake?
‚Ä¢ **F√∏lsomhetsanalyse**: Hva hvis forutsetningene endres?

**Fra synsing til systematikk**

Med disse verkt√∏yene kan vi g√• fra:
‚ùå "Jeg tror dette er en god investering"
‚úÖ "Analysen viser at investeringen har positiv n√•verdi p√• 2,3 millioner ved 8% avkastningskrav"

‚ùå "La oss satse p√• det nye produktet"
‚úÖ "Selv med 20% lavere salg enn forventet, gir produktet 15% internrente"

**Realisme og begrensninger**

Investeringsanalyse er kraftfullt, men ikke magisk:
‚Ä¢ Analysen er bare s√• god som forutsetningene
‚Ä¢ "Garbage in, garbage out" - d√•rlige data gir d√•rlige svar
‚Ä¢ Ikke alt kan kvantifiseres (f.eks. omd√∏mmeeffekter)
‚Ä¢ Fremtiden er usikker uansett hvor mye vi analyserer

Men: En beslutning basert p√• grundig analyse med usikre forutsetninger er fortsatt bedre enn en beslutning basert p√• synsing!

**Din siste investeringsbeslutning**

F√∏r vi g√•r videre, tenk p√• en st√∏rre √∏konomisk beslutning du har tatt:
‚Ä¢ Hva var alternativene?
‚Ä¢ Hvilke kriterier brukte du?
‚Ä¢ Gjorde du noen beregninger?
‚Ä¢ Ville en grundig analyse endret beslutningen?

**Veien videre**

I de neste delene skal vi bygge opp verkt√∏ykassen steg for steg:
1. F√∏rst l√¶rer vi √• identifisere relevante kontantstr√∏mmer
2. S√• beregner vi n√•verdi for √• vurdere l√∏nnsomhet
3. Deretter ser vi p√• alternative m√•l som IRR
4. Til slutt l√¶rer vi √• h√•ndtere usikkerhet

M√•let er at du etter denne modulen skal kunne analysere alt fra personlige investeringer (skal jeg ta videreutdanning?) til milliardinvesteringer (skal selskapet bygge ny fabrikk?).

**üéØ Det viktigste √• huske**

‚Ä¢ En investering = Gi avkall p√• noe n√• for √• f√• mer senere
‚Ä¢ Alle √∏konomiske beslutninger over tid er investeringer
‚Ä¢ Uten analyse blir det gambling
‚Ä¢ Investeringsanalyse gir objektive beslutningsgrunnlag
‚Ä¢ Verkt√∏yene fungerer for b√•de sm√• og store beslutninger

**Refleksjonssp√∏rsm√•l:** Mange sier "jeg er ikke god p√• tall" som unnskyldning for √• ikke gj√∏re investeringsanalyser. Men er det virkelig bedre √• ta millionbeslutninger basert p√• magef√∏lelse fremfor enkle beregninger?`
    }
  ]
};

async function addModule71() {
  try {
    // First find module 7
    const { data: module7, error: moduleError } = await supabase
      .from('modules')
      .select('id')
      .eq('order_index', 7)
      .single();

    if (moduleError) {
      console.error('Error fetching module 7:', moduleError);
      // If module 7 doesn't exist, we might need to create it first
      if (moduleError.code === 'PGRST116') {
        console.log('Module 7 not found. Creating it first...');
        
        // Create module 7
        const { data: newModule, error: createError } = await supabase
          .from('modules')
          .insert({
            title: 'Investeringsanalyse',
            description: 'Fra id√© til beslutning med kontantstr√∏m, n√•verdi og f√∏lsomhetstesting',
            order_index: 7,
            course_id: '7e098785-f51d-48f8-b4de-de492a451d52', // You may need to adjust this
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
          })
          .select()
          .single();

        if (createError) {
          console.error('Error creating module 7:', createError);
          return;
        }

        console.log('Created module 7 with id:', newModule.id);
        module7 = newModule;
      } else {
        return;
      }
    }

    console.log('Found/created module 7 with id:', module7.id);

    // Check if sub-module 7.1 already exists
    const { data: existingSubModule, error: fetchError } = await supabase
      .from('sub_modules')
      .select('*')
      .eq('module_id', module7.id)
      .eq('order_index', 1)
      .single();

    if (fetchError && fetchError.code !== 'PGRST116') {
      console.error('Error fetching sub-module:', fetchError);
      return;
    }

    if (existingSubModule) {
      // Update existing sub-module
      const { error: updateError } = await supabase
        .from('sub_modules')
        .update({ 
          title: 'Hvorfor investeringsanalyse?',
          content: module71Content,
          updated_at: new Date().toISOString()
        })
        .eq('id', existingSubModule.id);

      if (updateError) {
        console.error('Error updating sub-module 7.1:', updateError);
      } else {
        console.log('Successfully updated sub-module 7.1');
      }
    } else {
      // Create new sub-module
      const { error: insertError } = await supabase
        .from('sub_modules')
        .insert({
          module_id: module7.id,
          title: 'Hvorfor investeringsanalyse?',
          content: module71Content,
          order_index: 1,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        });

      if (insertError) {
        console.error('Error creating sub-module 7.1:', insertError);
      } else {
        console.log('Successfully created sub-module 7.1');
      }
    }
  } catch (error) {
    console.error('Unexpected error:', error);
  }
}

addModule71();