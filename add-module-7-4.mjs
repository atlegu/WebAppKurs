import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://tqpryezzddufpovfbpld.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHJ5ZXp6ZGR1ZnBvdmZicGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0NjA5MDksImV4cCI6MjA2NzAzNjkwOX0.TYmpggmCUr_7aNN_KKC5igvyT_QOWjFpa4_wlX_hjpE';

const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Module 7.4 content
const module74Content = {
  sections: [
    {
      title: "Andre investeringsmÃ¥l",
      type: "content",
      content: `**Supplerende verktÃ¸y - med sine begrensninger**

NPV er gullstandarden i investeringsanalyse, men andre mÃ¥l kan gi tilleggsinformasjon. La oss utforske de vanligste mÃ¥lene, deres bruksomrÃ¥der og - viktigst - deres begrensninger.

!component:investment-metrics-comparison

**Internrente (IRR) - Den populÃ¦re, men problematiske**

Internrenten er avkastningen som gir NPV = 0. Mange ledere elsker IRR fordi den gir et enkelt prosenttall: "Dette prosjektet gir 15% avkastning!"

**Matematisk definisjon:**
IRR er renten r som lÃ¸ser: Î£[CFâ‚œ / (1+r)áµ—] = 0

**Beslutningsregel:**
- Aksepter hvis IRR > avkastningskrav
- Forkast hvis IRR < avkastningskrav

**SÃ¥ langt hÃ¸res det greit ut. Hva er problemet?**

**Problem 1: Multiple IRR**
Hvis kontantstrÃ¸mmene skifter fortegn flere ganger, kan du fÃ¥ flere IRR-er:

Eksempel:
- Ã…r 0: -1000
- Ã…r 1: +3000  
- Ã…r 2: -2100

Dette gir to IRR-er: 10% og 100%. Hvilken skal du bruke?

**Problem 2: Reinvesteringsantagelse**
IRR antar implisitt at alle mellomliggende kontantstrÃ¸mmer kan reinvesteres til IRR-renten. Er det realistisk at du kan reinvestere til 30% hvis det er prosjektets IRR?

**Problem 3: Skalaproblemer**
- Prosjekt A: InvestÃ©r 100 kr, fÃ¥ 150 kr tilbake. IRR = 50%
- Prosjekt B: InvestÃ©r 1 million, fÃ¥ 1,2 millioner tilbake. IRR = 20%

IRR sier A er best, men B skaper 200 000 kr i verdi mot As 50 kr!

**Problem 4: Gjensidig utelukkende prosjekter**
Ved valg mellom prosjekter kan IRR gi feil svar. NPV og IRR kan rangere prosjekter ulikt, og da har NPV alltid rett.

**NÃ¥r er IRR nyttig?**
- Som et supplement til NPV
- NÃ¥r du sammenligner prosjekter av lik stÃ¸rrelse
- For Ã¥ kommunisere lÃ¸nnsomhet i prosent
- Aldri som eneste beslutningskriterium!

**Tilbakebetalingstid - Fokus pÃ¥ likviditet**

Tilbakebetalingstid = Hvor lang tid tar det fÃ¸r investeringen er tjent inn?

**To varianter:**
1. **Enkel tilbakebetalingstid**: Ignorerer tidsverdien
2. **Diskontert tilbakebetalingstid**: Tar hensyn til tidsverdien

**Eksempel:**
Investering: 1 000 000 kr
Ã…rlige kontantstrÃ¸mmer: 300 000 kr

Enkel tilbakebetalingstid: 1 000 000 / 300 000 = 3,33 Ã¥r
Diskontert tilbakebetalingstid ved 10%: ca. 4,2 Ã¥r

**Fordeler:**
- Enkelt Ã¥ forstÃ¥
- Fokus pÃ¥ likviditet og risiko
- Nyttig for bedrifter med likviditetsproblemer

**Ulemper:**
- Ignorerer kontantstrÃ¸mmer etter cut-off
- VilkÃ¥rlig cut-off periode
- Kan forkaste lÃ¸nnsomme langsiktige prosjekter

**NÃ¥r bruke tilbakebetalingstid?**
- Som tilleggsinformasjon om likviditetsrisiko
- I usikre miljÃ¸er hvor fremtiden er svÃ¦rt usikker
- For smÃ¥ bedrifter med begrenset tilgang til kapital
- Aldri som eneste kriterium!

**LÃ¸nnsomhetsindeks (PI) - NPV i forhold til investering**

PI = NÃ¥verdi av fremtidige kontantstrÃ¸mmer / Initiell investering

eller

PI = 1 + (NPV / Initiell investering)

**Beslutningsregel:**
- PI > 1: Aksepter
- PI < 1: Forkast
- PI = 1: Break-even

**Eksempel:**
NPV = 200 000 kr, Investering = 1 000 000 kr
PI = 1 + (200 000 / 1 000 000) = 1,20

Tolkning: For hver krone investert fÃ¥r du 1,20 kr i nÃ¥verdi tilbake.

**Fordeler:**
- Viser relativ lÃ¸nnsomhet
- Nyttig ved kapitalrasjonering
- Lett Ã¥ sammenligne prosjekter av ulik stÃ¸rrelse

**Ulemper:**
- Kan gi feil rangering ved gjensidig utelukkende prosjekter
- Som IRR, favoriserer smÃ¥ prosjekter med hÃ¸y relativ avkastning

**Kapitalrasjonering - NÃ¥r du ikke kan ta alle positive NPV-prosjekter**

I en perfekt verden tar du alle prosjekter med positiv NPV. I praksis har bedrifter ofte:
- Begrenset kapital
- Begrenset ledelseskapasitet
- Risikogrenser

**Ved kapitalrasjonering:**
1. Ranger etter PI (ikke NPV!)
2. Ta prosjekter i rekkefÃ¸lge til kapitalen er brukt opp
3. Sjekk for avhengigheter mellom prosjekter

**MÃ¥lkonflikter - Hvem vinner?**

La oss se pÃ¥ et klassisk eksempel:

**Prosjekt A:**
- Investering: 10 000 kr
- Ã…r 1: 12 000 kr
- NPV (10%): 909 kr
- IRR: 20%
- Tilbakebetaling: 1 Ã¥r

**Prosjekt B:**
- Investering: 10 000 kr
- Ã…r 1-5: 3 000 kr per Ã¥r
- NPV (10%): 1 372 kr
- IRR: 15,2%
- Tilbakebetaling: 3,33 Ã¥r

**Hva sier de ulike mÃ¥lene?**
- NPV: B er best (hÃ¸yere NPV)
- IRR: A er best (hÃ¸yere IRR)
- Tilbakebetaling: A er best (kortere tid)

**Hvem har rett? NPV!** B skaper mer verdi for bedriften.

**Praktiske retningslinjer**

**Bruk NPV som hovedregel fordi:**
- MÃ¥ler verdiskaping direkte
- Tar hensyn til alle kontantstrÃ¸mmer
- Konsistent med mÃ¥let om verdimaksimering
- Additivt (NPV(A+B) = NPV(A) + NPV(B))

**Bruk IRR som supplement nÃ¥r:**
- Du vil kommunisere i prosent
- Prosjektene er av lik stÃ¸rrelse
- KontantstrÃ¸mmene har normalt mÃ¸nster

**Bruk tilbakebetalingstid nÃ¥r:**
- Likviditet er kritisk
- Fremtiden er svÃ¦rt usikker
- Som grov screening av prosjekter

**Bruk PI nÃ¥r:**
- Du har kapitalrasjonering
- Du mÃ¥ rangere mange smÃ¥ prosjekter
- Som supplement til NPV

**Vanlige feil Ã¥ unngÃ¥**

1. **"Vi krever 3 Ã¥rs tilbakebetalingstid pÃ¥ alle prosjekter"**
   Feil: Kan forkaste svÃ¦rt lÃ¸nnsomme langsiktige prosjekter

2. **"Vi tar prosjektet med hÃ¸yest IRR"**
   Feil: Ignorerer prosjektstÃ¸rrelse og reinvesteringsproblemer

3. **"NPV er for teoretisk, vi bruker IRR"**
   Feil: IRR har flere teoretiske problemer enn NPV

4. **"Vi bruker alle mÃ¥lene og tar gjennomsnittet"**
   Feil: Ved konflikt har NPV alltid rett

**Oppsummering**

- **NPV er sjefen** - bruk alltid NPV som hovedkriterium
- **IRR kan villede** - vÃ¦r klar over begrensningene
- **Tilbakebetalingstid** - nyttig for likviditetsvurdering
- **PI** - best ved kapitalrasjonering
- **Ved konflikt** - NPV vinner alltid!

**Husk:** Andre mÃ¥l gir tilleggsinformasjon, men skal aldri overstyre NPV. En god analyse presenterer flere mÃ¥l, men konkluderer basert pÃ¥ NPV.

**Neste steg**

NÃ¥ som vi forstÃ¥r de ulike mÃ¥lene, skal vi se pÃ¥ hvordan usikkerhet pÃ¥virker investeringsanalysen. Hvordan hÃ¥ndterer vi at vÃ¥re estimater sjelden treffer 100%?

**ðŸŽ¯ Tommelfingerregel: Present gjerne IRR og tilbakebetalingstid i tillegg til NPV, men la aldri disse mÃ¥lene overstyre en positiv NPV!**

**RefleksjonsspÃ¸rsmÃ¥l:** Mange ledere foretrekker IRR fremfor NPV fordi "alle forstÃ¥r prosent". Hvorfor kan dette fokuset pÃ¥ "enkel kommunikasjon" fÃ¸re til dÃ¥rlige investeringsbeslutninger? Hvordan kan du som analytiker best formidle NPV-konseptet til ledere som er vant til Ã¥ tenke i prosent?`
    }
  ]
};

async function addModule74() {
  try {
    // Find module 7
    const { data: module7, error: moduleError } = await supabase
      .from('modules')
      .select('id')
      .eq('order_index', 7)
      .single();

    if (moduleError) {
      console.error('Error fetching module 7:', moduleError);
      return;
    }

    console.log('Found module 7 with id:', module7.id);

    // Check if sub-module 7.4 already exists
    const { data: existingSubModule, error: fetchError } = await supabase
      .from('sub_modules')
      .select('*')
      .eq('module_id', module7.id)
      .eq('order_index', 4)
      .single();

    if (fetchError && fetchError.code !== 'PGRST116') {
      console.error('Error fetching sub-module:', fetchError);
      return;
    }

    if (existingSubModule) {
      // Update existing sub-module
      const { error: updateError } = await supabase
        .from('sub_modules')
        .update({ 
          title: 'Andre investeringsmÃ¥l',
          content: module74Content,
          updated_at: new Date().toISOString()
        })
        .eq('id', existingSubModule.id);

      if (updateError) {
        console.error('Error updating sub-module 7.4:', updateError);
      } else {
        console.log('Successfully updated sub-module 7.4');
      }
    } else {
      // Create new sub-module
      const { error: insertError } = await supabase
        .from('sub_modules')
        .insert({
          module_id: module7.id,
          title: 'Andre investeringsmÃ¥l',
          content: module74Content,
          order_index: 4,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        });

      if (insertError) {
        console.error('Error creating sub-module 7.4:', insertError);
      } else {
        console.log('Successfully created sub-module 7.4');
      }
    }
  } catch (error) {
    console.error('Unexpected error:', error);
  }
}

addModule74();