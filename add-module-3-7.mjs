import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://tqpryezzddufpovfbpld.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxcHJ5ZXp6ZGR1ZnBvdmZicGxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0NjA5MDksImV4cCI6MjA2NzAzNjkwOX0.TYmpggmCUr_7aNN_KKC5igvyT_QOWjFpa4_wlX_hjpE';

const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Module 3.7 content - proper structure for sub-modules
const module37Content = {
  sections: [
    {
      title: "Inflasjon og reell rente",
      type: "content",
      content: `**La oss f√∏rst se hva inflasjon betyr i praksis!**

Start med √• utforske den interaktive kalkulatoren nedenfor. Legg spesielt merke til hvordan inflasjon p√•virker kj√∏pekraften din over tid, selv n√•r du f√•r renter p√• sparepengene.

!component:inflation-real-rate

**Viktig begrepsavklaring**

I forrige modul (3.6) brukte vi begrepet "nominell rente" om den oppgitte renten f√∏r rentesammensetning. I denne modulen bruker vi "nominell rente" i en annen betydning:

‚Ä¢ **Nominell rente (i denne modulen)**: Renten som inkluderer inflasjon - den viser endring i antall kroner
‚Ä¢ **Reell rente**: Renten justert for inflasjon - den viser endring i kj√∏pekraft

Dette er standard begrepsbruk i √∏konomi n√•r vi diskuterer inflasjon.

**Hva er egentlig inflasjon?**

Tenk deg at du g√•r i butikken i dag og fyller handlekurven med varer for 1000 kroner. Inflasjon betyr at den samme kurven med varer vil koste mer enn 1000 kroner i fremtiden:

‚Ä¢ Om 1 √•r med 2% inflasjon: 1020 kr
‚Ä¢ Om 5 √•r med 2% inflasjon: 1104 kr  
‚Ä¢ Om 10 √•r med 2% inflasjon: 1219 kr

Inflasjon er alts√• den generelle prisstigningen i √∏konomien over tid. Pengene dine mister gradvis kj√∏pekraft.

**Prisstigning p√• enkeltvarer vs. generell inflasjon**

Det er viktig √• skille mellom:

1. **Prisstigning p√• enkeltvarer**: Bensinprisen kan g√• opp 20% p√• grunn av √∏kt oljepris
2. **Generell inflasjon**: Gjennomsnittlig prisstigning p√• alle varer og tjenester

Eksempel:
‚Ä¢ Bensin: +20%
‚Ä¢ Mat: +3%
‚Ä¢ Kl√¶r: -5%
‚Ä¢ Bolig: +8%
‚Ä¢ Transport: +4%

Den generelle inflasjonen blir et vektet gjennomsnitt basert p√• hva folk faktisk bruker penger p√•.

**Konsumprisindeksen (KPI)**

Statistisk sentralbyr√• (SSB) m√•ler inflasjon gjennom konsumprisindeksen:

‚Ä¢ En "handlekurv" med ca. 700 varer og tjenester
‚Ä¢ Vektet etter norske husholdningers forbruksm√∏nster
‚Ä¢ Oppdateres m√•nedlig
‚Ä¢ Brukes til √• justere l√∏nn, pensjoner, og sosiale ytelser

Typisk vekting i KPI:
‚Ä¢ Bolig og energi: 23%
‚Ä¢ Transport: 16%
‚Ä¢ Mat og drikke: 13%
‚Ä¢ Kultur og fritid: 11%
‚Ä¢ Kl√¶r og sko: 5%
‚Ä¢ √òvrige varer: 32%

**Fisher-ligningen: Sammenhengen mellom nominell og reell rente**

Irving Fisher utledet sammenhengen mellom nominell rente, reell rente og inflasjon:

**(1 + nominell rente) = (1 + reell rente) √ó (1 + inflasjon)**

Dette kan skrives om til:

**Reell rente = [(1 + nominell rente) / (1 + inflasjon)] - 1**

For lave renter kan vi bruke tiln√¶rmingen:

**Reell rente ‚âà Nominell rente - Inflasjon**

**Eksempel p√• beregning**

La oss si du har:
‚Ä¢ Nominell rente p√• sparekonto: 5%
‚Ä¢ Inflasjon: 2%

Eksakt beregning:
Reell rente = (1,05 / 1,02) - 1 = 0,0294 = 2,94%

Tiln√¶rming:
Reell rente ‚âà 5% - 2% = 3%

Forskjellen er liten ved lave renter, men blir st√∏rre ved h√∏ye renter eller inflasjon.

**Hvorfor er reell rente viktig?**

1. **For sparere**: Reell rente viser om sparingen din faktisk √∏ker kj√∏pekraften
2. **For l√•ntakere**: Negativ reell rente betyr at gjelden blir "billigere" over tid
3. **For investorer**: Alle investeringer m√• vurderes mot reell avkastning
4. **For samfunnet**: Sentralbanken bruker realrenten som styringsverkt√∏y

**Historiske eksempler**

**1970-tallet - H√∏y inflasjon:**
‚Ä¢ Nominell rente: 12%
‚Ä¢ Inflasjon: 10%
‚Ä¢ Reell rente: 1,8%

De som hadde fastrentel√•n tjente stort, mens sparere tapte kj√∏pekraft.

**2020-tallet - Lavrentetid:**
‚Ä¢ Nominell rente: 1%
‚Ä¢ Inflasjon: 3%
‚Ä¢ Reell rente: -1,9%

Sparere taper kj√∏pekraft, mens l√•ntakere tjener p√• negativ realrente.

**Inflasjonsjusterte (indekserte) produkter**

For √• beskytte mot inflasjon finnes det finansielle produkter som:

1. **Inflasjonsjusterte obligasjoner**: Hovedstol og renter justeres med KPI
2. **Realrenteobligasjoner**: Gir en fast reell rente pluss inflasjon
3. **Indekserte l√•n**: L√•nebel√∏pet justeres med inflasjon

**Praktiske implikasjoner**

**For privatpersoner:**
‚Ä¢ Vurder alltid reell avkastning, ikke bare nominell
‚Ä¢ I perioder med h√∏y inflasjon: Vurder realaktiva (eiendom, aksjer)
‚Ä¢ Ved l√•neopptak: Fastrentel√•n er gunstig hvis du forventer √∏kt inflasjon

**For bedrifter:**
‚Ä¢ Prissetting m√• ta hensyn til forventet inflasjon
‚Ä¢ Langsiktige kontrakter b√∏r ha indeksklausuler
‚Ä¢ Investeringsbeslutninger m√• baseres p√• reelle st√∏rrelser

**üéØ Det viktigste √• huske**

‚Ä¢ Nominell rente = rente inkludert inflasjon (endring i kroner)
‚Ä¢ Reell rente = rente justert for inflasjon (endring i kj√∏pekraft)
‚Ä¢ Reell rente ‚âà Nominell rente - Inflasjon (for lave renter)
‚Ä¢ Inflasjon m√•les gjennom KPI (konsumprisindeksen)
‚Ä¢ Positiv reell rente = √∏kt kj√∏pekraft
‚Ä¢ Negativ reell rente = tapt kj√∏pekraft

**Refleksjonssp√∏rsm√•l:** I perioder med h√∏y inflasjon sier folk ofte at "det l√∏nner seg √• ha gjeld". Kan du forklare hvorfor dette stemmer n√•r vi ser p√• reell rente? Hvem er vinnere og tapere i et h√∏yinflasjonsscenario?`
    }
  ]
};

async function addModule37() {
  try {
    // First find module 3 (Tidsverdien av penger)
    const { data: module3, error: moduleError } = await supabase
      .from('modules')
      .select('id')
      .eq('order_index', 3)
      .single();

    if (moduleError) {
      console.error('Error fetching module 3:', moduleError);
      return;
    }

    console.log('Found module 3 with id:', module3.id);

    // Check if sub-module 3.7 already exists
    const { data: existingSubModule, error: fetchError } = await supabase
      .from('sub_modules')
      .select('*')
      .eq('module_id', module3.id)
      .eq('order_index', 7)
      .single();

    if (fetchError && fetchError.code !== 'PGRST116') {
      console.error('Error fetching sub-module:', fetchError);
      return;
    }

    if (existingSubModule) {
      // Update existing sub-module
      const { error: updateError } = await supabase
        .from('sub_modules')
        .update({ 
          title: 'Inflasjon og reell rente',
          content: module37Content,
          updated_at: new Date().toISOString()
        })
        .eq('id', existingSubModule.id);

      if (updateError) {
        console.error('Error updating sub-module 3.7:', updateError);
      } else {
        console.log('Successfully updated sub-module 3.7');
      }
    } else {
      // Create new sub-module
      const { error: insertError } = await supabase
        .from('sub_modules')
        .insert({
          module_id: module3.id,
          title: 'Inflasjon og reell rente',
          content: module37Content,
          order_index: 7,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        });

      if (insertError) {
        console.error('Error creating sub-module 3.7:', insertError);
      } else {
        console.log('Successfully created sub-module 3.7');
      }
    }
  } catch (error) {
    console.error('Unexpected error:', error);
  }
}

addModule37();